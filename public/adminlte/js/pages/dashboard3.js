$(function(){"use strict";$("#tablesResume").DataTable();var e={fontColor:"#495057",fontStyle:"bold"},t=$("#sales-chart");new Chart(t,{type:"bar",data:{labels:["JUN","JUL","AUG","SEP","OCT","NOV","DEC"],datasets:[{backgroundColor:"#007bff",borderColor:"#007bff",data:[1e3,2e3,3e3,2500,2700,2500,3e3]},{backgroundColor:"#ced4da",borderColor:"#ced4da",data:[700,1700,2700,2e3,1800,1500,2e3]}]},options:{maintainAspectRatio:!1,tooltips:{mode:"index",intersect:!0},hover:{mode:"index",intersect:!0},legend:{display:!1},scales:{yAxes:[{gridLines:{display:!0,lineWidth:"4px",color:"rgba(0, 0, 0, .2)",zeroLineColor:"transparent"},ticks:$.extend({beginAtZero:!0,callback:function(e){return e>=1e3&&(e/=1e3,e+="k"),"$"+e}},e)}],xAxes:[{display:!0,gridLines:{display:!1},ticks:e}]}}});$.ajax({url:"/resumen/sales",type:"GET",contentType:"application/json",headers:{"X-CSRF-TOKEN":$('meta[name="csrf-token"]').attr("content"),contentType:"application/json"},success:function(t){var a,r=t.orders,n=t.dates,s=t.products,o=0,i=t.rolUser,d=t.idUser,l=0,c=0,p=0,h=0,f=0,u=0,g=0,x=0,m=0,_=0,b=0,v=0,C=0;let O=0,y=0;for(var w,D=0,S=[],P={},N={},E={},T={},k={},F=0;F<r.length;F++)3==r[F].state_order_id&&(0!=r.length?o++:o=0);$("#quantity_sales").text(o),S=function(){let e=[];var t=new Date;let a=0;do{0!=a&&t.setDate(t.getDate()-1);let r=t.getDate()+"/"+(t.getMonth()+1)+"/"+t.getFullYear();e.push(r),a++}while(a<7);return e}(),w=function(){let e=[];var t=new Date;let a=0;do{0!=a&&t.setDate(t.getDate()-1);let r=t.getDate()+"/"+(t.getMonth()+1)+"/"+t.getFullYear();e.push(r),a++}while(a<2);return e}();for(let e=0;e<S.length;e++){for(let t=0;t<n.length;t++){let a=new Date(n[t].fecha);a.setDate(a.getDate());var j=a.getDate()+"/"+(a.getMonth()+1)+"/"+a.getFullYear();if(S[e]==j){O+=parseFloat(n[t].total),P[j]=O,y+=1,N[j]=y}}y=0,O=0}console.log();var A=Object.keys(P);for(var U in S)0==A.includes(S[U])&&(P[S[U]]=0);var I=Object.keys(N);for(var R in S)0==I.includes(S[R])&&(N[S[R]]=0);var B=Object.values(P),L=Object.values(N);a=B.reduce((e,t)=>Math.max(e,t),-Number.POSITIVE_INFINITY);for(F=0;F<r.length;F++)1==r[F].state_order_id?l++:2==r[F].state_order_id?c++:3==r[F].state_order_id?h++:4==r[F].state_order_id?p++:5==r[F].state_order_id?f++:6==r[F].state_order_id?u++:7==r[F].state_order_id&&g++;if(4==i)for(var z=0;z<r.length;z++)d==r[z].user_id&&(1==r[z].state_order_id?x++:2==r[z].state_order_id?m++:3==r[z].state_order_id?b++:4==r[z].state_order_id?_++:5==r[z].state_order_id?v++:6!=r[z].state_order_id&&7!=r[z].state_order_id||C++);$("#toggleNewOrder").text(l),$("#toggleProcessOrder").text(c),$("#toggleCancelOrder").text(p),$("#toggleDeliveredOrder").text(h),0!==l&&$("#NewOrders").text(l),0!==c&&$("#ProcessOrders").text(c),0!==p&&$("#CancelOrders").text(p),0!==h&&$("#DeliveredOrders").text(h),0!==f&&$("#PendingOrders").text(f),0!==u&&$("#PendingAprobationLogistic").text(u),0!==g&&$("#PendingAprobationDeposit").text(g),0!==x&&$("#NewOrdersSales").text(x),0!==m&&$("#ProcessOrdersSales").text(m),0!==_&&$("#CancelOrdersSales").text(_),0!==b&&$("#DeliveredOrdersSales").text(b),0!==v&&$("#PendingOrdersSales").text(v),0!==C&&$("#DepositSales").text(C),console.log(S),S.reverse(),B.reverse(),L.reverse();for(let e=0;e<w.length;e++){for(let t=0;t<n.length;t++){let a=new Date(n[t].fecha);a.setDate(a.getDate());let r=a.getDate()+"/"+(a.getMonth()+1)+"/"+a.getFullYear();if(w[e]==r&&3==n[t].state_order_id){D+=parseFloat(n[t].total),E[w[e]]=D}}D=0}for(var M=Object.values(E),Y=0;Y<M.length;Y++)var q=M[0],G=M[1];if(""==q||null==q||null==q)var J=(y=100*((q=0)/G-1)).toFixed()+"%";else J=(y=100*(q/G-1)).toFixed()+"%";if(y<=0){$(".percentage").text(J),document.querySelector(".percentage").style.setProperty("color","red"),$(".percentage").each(function(){$(this).append('<i class="fas fa-arrow-down"></i>')})}else if(y>0){$(".percentage").text(J),document.querySelector(".percentage").style.setProperty("color","green"),$(".percentage").each(function(){$(this).append('<i class="fas fa-arrow-up"></i>')})}else if(isNaN(y)){$(".percentage").text("No se registran ventas hoy");let e=document.querySelector(".percentage");e.style.setProperty("opacity","0.5"),e.style.setProperty("font-size","0.85em")}let V=0;var W=0;!function(){for(let e=0;e<s.length;e++){for(let t=0;t<r.length;t++)if(3==r[t].state_order_id)for(let a=0;a<r[t].order_items.length;a++)s[e].id==r[t].order_items[a].product_id&&(V++,T[[s[e].id]]=V);V=0}Object.values(T).forEach(function(e){W+=e})}();F=-1;var Z=Object.values(T);for(let e=0;e<Z.length;e++){F++;var K=document.getElementById("insertTD-"+F),X=Z[e]/W*100,H=X.toFixed(2)+"%",Q=document.createElement("td");X>=20?($(Q).each(function(){$(this).append('<i class="text-success fas fa-arrow-up"></i>'),$(this).append('<small style="font-size: .85em;" class="text-success mr-1" id="percentSales">'+H+"</small>"),$(this).append("Sold")}),K.appendChild(Q)):X<=20?($(Q).each(function(){$(this).append('<i class="text-danger fas fa-arrow-down"></i>'),$(this).append('<small style="font-size: .85em;" class="text-danger mr-1" id="percentSales">'+H+"</small>"),$(this).append("Sold")}),K.appendChild(Q)):""!=X&&0!=X||($(Q).each(function(){$(this).append('<i class="text-danger fas fa-arrow-down"></i>'),$(this).append('<small style="font-size: .85em;" class="text-danger mr-1" id="percentSales">0%</small>'),$(this).append("Sold")}),K.appendChild(Q))}let ee=0;var te=0;!function(){for(let e=0;e<r.length;e++){if(3==r[e].state_order_id)for(let t=0;t<r[e].order_items.length;t++)r[e].id==r[e].order_items[t].order_id&&(ee++,k["Pedido #"+[r[e].id]]=ee);ee=0}for(let e=0;e<r.length;e++)if(3==r[e].state_order_id)for(let t=0;t<r[e].order_items.length;t++)te++}();var ae=Object.values(k),re=0;for(let e=0;e<ae.length;e++)1==ae[e]&&re++;var ne=re/te*100,se=ne.toFixed(2)+"%",oe=document.getElementById("percentOne"),ie=document.createElement("span"),de=document.createElement("span");isNaN(ne)?($(ie).each(function(){$(this).attr("class","font-weight-bold"),$(this).append('<i class="ion ion-android-arrow-up text-danger"> </i> '),$(this).append("0%")}),$(de).each(function(){$(this).attr("class","text-muted"),$(this).append("1 PRODUCTO")}),oe.appendChild(ie),oe.appendChild(de)):($(ie).each(function(){$(this).attr("class","font-weight-bold"),$(this).append('<i class="ion ion-android-arrow-up text-danger"> </i> '),$(this).append(se)}),$(de).each(function(){$(this).attr("class","text-muted"),$(this).append("1 PRODUCTO")}),oe.appendChild(ie),oe.appendChild(de));var le=Object.values(k),ce=0;for(let e=0;e<le.length;e++)ae[e]>=2&&ae[e]<=3&&ce++;var pe=ce/te*100,he=pe.toFixed(2)+"%",fe=document.getElementById("percentTwo"),ue=document.createElement("span"),ge=document.createElement("span");isNaN(pe)?($(ue).each(function(){$(this).attr("class","font-weight-bold"),$(this).append('<i class="ion ion-android-arrow-up text-warning"> </i> '),$(this).append("0%")}),$(ge).each(function(){$(this).attr("class","text-muted"),$(this).append("2 a 3 PRODUCTOS")}),fe.appendChild(ue),fe.appendChild(ge)):($(ue).each(function(){$(this).attr("class","font-weight-bold"),$(this).append('<i class="ion ion-android-arrow-up text-warning"> </i> '),$(this).append(he)}),$(ge).each(function(){$(this).attr("class","text-muted"),$(this).append("2 a 3 PRODUCTOS")}),fe.appendChild(ue),fe.appendChild(ge));var $e=Object.values(k),xe=0;for(let e=0;e<$e.length;e++)ae[e]>=4&&xe++;var me=xe/te*100,_e=me.toFixed(2)+"%",be=document.getElementById("percentThree"),ve=document.createElement("span"),Ce=document.createElement("span");isNaN(me)?($(ve).each(function(){$(this).attr("class","font-weight-bold"),$(this).append('<i class="ion ion-android-arrow-up text-success"> </i> '),$(this).append("0%")}),$(Ce).each(function(){$(this).attr("class","text-muted"),$(this).append("+4 PRODUCTOS")}),be.appendChild(ve),be.appendChild(Ce)):($(ve).each(function(){$(this).attr("class","font-weight-bold"),$(this).append('<i class="ion ion-android-arrow-up text-success"> </i> '),$(this).append(_e)}),$(Ce).each(function(){$(this).attr("class","text-muted"),$(this).append("+4 PRODUCTOS")}),be.appendChild(ve),be.appendChild(Ce));var Oe=$("#visitors-chart");new Chart(Oe,{data:{labels:S,datasets:[{type:"line",data:B,backgroundColor:"transparent",borderColor:"#007bff",pointBorderColor:"#007bff",pointBackgroundColor:"#007bff",fill:!1},{type:"line",data:L,backgroundColor:"tansparent",borderColor:"#ffffff",pointBorderColor:"#ffffff",pointBackgroundColor:"#ffffff",fill:!1}]},options:{maintainAspectRatio:!1,tooltips:{mode:"index",intersect:!0},hover:{mode:"index",intersect:!0},legend:{display:!1},scales:{yAxes:[{gridLines:{display:!0,lineWidth:"4px",color:"rgba(0, 0, 0, .2)",zeroLineColor:"transparent"},ticks:$.extend({beginAtZero:!0,callback:function(e){return parseInt(e)>=1e3?"$"+e.toString().replace(/\B(?=(\d{3})+(?!\d))/g,","):"$"+e},suggestedMax:a},e)}],xAxes:[{display:!0,gridLines:{display:!1},ticks:e}]}}})}})});